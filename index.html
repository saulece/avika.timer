<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avika - Temporizador de Sushi</title>
    <link rel="stylesheet" href="avika-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="icon" href="data:,">
</head>
<body>
    <header>
        <h1>Avika - Temporizador de Sushi</h1>
        <div class="header-controls">
            <button id="btn-help" class="icon-btn" title="Mostrar ayuda"><i class="fas fa-question-circle"></i></button>
            <button id="btn-dashboard" class="icon-btn" title="Mostrar/ocultar tablero de monitoreo"><i class="fas fa-chart-line"></i></button>
        </div>
    </header>
    
    <div class="container">
        <!-- Notificaciones -->
        <div id="notification" style="display:none;"></div>
        
        <!-- Sección de categorías -->
        <div id="categories-section">
            <h2>Selecciona una categoría</h2>
            <div class="category-container">
                <button class="category-btn" data-category="frio" data-tooltip="Platillos fríos como rollos y makis">Platillos Fríos</button>
                <button class="category-btn" data-category="entrada-fria" data-tooltip="Entradas frías como ceviches y sashimis">Entradas Frías</button>
                <button class="category-btn" data-category="caliente" data-tooltip="Platillos calientes y sopas">Platillos Calientes</button>
                <button class="category-btn" data-category="entrada-caliente" data-tooltip="Entradas calientes como empanizados">Entradas Calientes</button>
                <button class="category-btn" data-category="combos" data-tooltip="Combos y promociones especiales">Combos</button>
            </div>
            
            <!-- Órdenes pendientes -->
            <div class="pending-orders-section">
                <h2>Platillos en preparación <span id="pending-count">0</span></h2>
                <div class="action-btns" style="margin-bottom: 10px;">
                    <button class="action-btn" id="btn-new-ticket" data-tooltip="Crear un nuevo ticket con múltiples platillos">Nuevo Ticket/Comanda</button>
                    <button class="action-btn" id="btn-force-complete" style="background-color: #ff9800;" data-tooltip="Solo usar en casos excepcionales cuando un ticket quedó atorado">Emergencia: Desbloquear</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Platillo</th>
                            <th>Inicio</th>
                            <th>Tiempo</th>
                            <th>Detalles</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody id="pending-body">
                        <!-- Se llenará con JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Órdenes completadas -->
            <div class="pending-orders-section">
                <h2>Platillos completados</h2>
                <div class="filter-controls">
                    <button id="btn-show-all-history" class="filter-btn" data-tooltip="Ver todas las órdenes completadas">Ver historial completo</button>
                    <button id="btn-show-recent" class="filter-btn active" data-tooltip="Ver solo las órdenes más recientes">Ver recientes</button>
                    <button id="btn-show-stats" class="filter-btn" data-tooltip="Ver estadísticas de tiempos promedios">Ver promedios</button>
                    <button id="btn-show-detailed-stats" class="filter-btn" data-tooltip="Ver estadísticas detalladas por tipo de cocina">Estadísticas detalladas</button>
                    <button id="btn-clear-history" class="filter-btn" data-tooltip="Eliminar historial de órdenes completadas">Limpiar historial</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Platillo</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Tiempo total</th>
                            <th>Detalles</th>
                        </tr>
                    </thead>
                    <tbody id="completed-body">
                        <!-- Se llenará con JavaScript -->
                    </tbody>
                </table>
                <button class="back-btn" id="btn-export" data-tooltip="Exportar datos para análisis">Exportar datos</button>
                <button class="back-btn" id="btn-export-enhanced" data-tooltip="Exportar datos con formato mejorado">Exportar detallado</button>
                <button class="back-btn" id="btn-export-excel" data-tooltip="Exportar datos en formato Excel">Exportar Excel</button>
            </div>
        </div>
        
        <!-- Sección de platillos -->
        <div id="dishes-section" style="display: none;">
            <h2 id="selected-category-title">Categoría</h2>
            <div id="dishes-container" class="dishes-container" style="display: block;">
                <!-- Se llenará con JavaScript -->
                <div id="debug-info" style="margin-top: 20px; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd;">
                    <p>Si no ves los platillos, actualiza la página con Ctrl+F5</p>
                </div>
            </div>
            
            <button class="back-btn" id="btn-back-to-categories">Volver a Categorías</button>
        </div>
        
        <!-- Sección de preparación -->
        <div id="preparation-section" class="preparation-section">
            <h2 id="selected-dish-title">Platillo seleccionado</h2>
            
            <div class="compact-form-container">
                <div class="option-group" id="service-options">
                    <div class="option-title">Tipo de servicio:</div>
                    <div class="option-btns">
                        <button id="btn-comedor" class="option-btn selected">Comedor</button>
                        <button id="btn-domicilio" class="option-btn">Domicilio</button>
                        <button id="btn-para-llevar" class="option-btn">Ordena y Espera</button>
                    </div>
                </div>
                
                <div class="option-group" id="quantity-control">
                    <div class="option-title">Cantidad:</div>
                    <div class="qty-control">
                        <button class="qty-btn">-</button>
                        <span id="quantity-display" class="qty-display">1</span>
                        <button class="qty-btn">+</button>
                    </div>
                </div>
                
                <div class="option-group" id="customization-options">
                    <div class="option-title">Personalizaciones:</div>
                    <div class="option-btns" id="customization-container">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-title">Notas adicionales:</div>
                    <textarea id="notes-input" class="notes-input" placeholder="Cualquier instrucción adicional..."></textarea>
                </div>
                
                <div class="action-btns">
                    <button id="btn-cancel" class="action-btn cancel-btn">Cancelar</button>
                    <button id="btn-start" class="action-btn start-btn">Iniciar preparación</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de ayuda -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Guía Rápida de Uso</h2>
            
            <div class="help-section">
                <h3>Flujo de trabajo básico</h3>
                <ol>
                    <li>Selecciona una categoría de platillo</li>
                    <li>Elige el platillo específico</li>
                    <li>Configura personalizaciones, tipo de servicio y cantidad</li>
                    <li>Inicia la preparación</li>
                    <li>Marca como "Listo" cuando el platillo esté terminado</li>
                </ol>
            </div>
            
            <div class="help-section">
                <h3>Trabajar con tickets</h3>
                <ol>
                    <li>Haz clic en "Nuevo Ticket/Comanda"</li>
                    <li>Añade varios platillos al ticket</li>
                    <li>Selecciona el tipo de servicio para todo el ticket</li>
                    <li>Guarda el ticket</li>
                    <li>Marca como "Listo" cada platillo a medida que se completen</li>
                    <li>El ticket se moverá a completados cuando todos los platillos estén listos</li>
                </ol>
            </div>
            
            <div class="help-section">
                <h3>Estados de los platillos</h3>
                <ul>
                    <li><strong>En preparación:</strong> Platillo recién agregado</li>
                    <li><strong>Esperando otros platillos:</strong> Este platillo ya está listo pero otros del mismo ticket aún no</li>
                    <li><strong>Listo para salida:</strong> Para domicilios, indica que está listo para entregar al repartidor</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>Tipos de cocina</h3>
                <ul>
                    <li><strong>Cocina Fría:</strong> Platillos que se preparan sin calor (makis, rollos, ceviches)</li>
                    <li><strong>Cocina Caliente:</strong> Platillos que requieren cocción (arroces, sopas)</li>
                    <li><strong>Combos Especiales:</strong> Requieren preparación en ambas cocinas</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>Tiempos objetivo</h3>
                <ul>
                    <li>Cocina Fría: 7 minutos</li>
                    <li>Cocina Caliente: 12 minutos</li>
                    <li>Combos Especiales: 15 minutos</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Cargar módulos en orden correcto -->
    <script src="js/avika-core.js"></script>
    <script src="js/modules/logger.js"></script>
    <script src="js/modules/config.js"></script>
    <script src="js/modules/date-utils.js"></script>
    <script src="js/modules/notification.js"></script>
    <script src="js/modules/storage.js"></script>
    <script src="js/modules/ui-controller.js"></script>
    <script src="js/modules/order-service.js"></script>
    <script src="js/modules/ticket-service.js"></script>
    <script src="js/modules/combo-handler.js"></script>
    <script src="js/modules/stats.js"></script>
    <script src="js/modules/stats-enhanced.js"></script>
    <script src="js/modules/dashboard.js"></script>
    <script src="js/fix.js"></script>
    <script src="js/modules/avika-fixes.js"></script>
    <script src="js/avika-init.js"></script>
    
    <!-- Script para tooltips y ayuda -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar modal de ayuda
        var helpModal = document.getElementById('help-modal');
        var helpBtn = document.getElementById('btn-help');
        var closeBtn = helpModal.querySelector('.close-modal');
        
        helpBtn.onclick = function() {
            helpModal.style.display = 'block';
        }
        
        closeBtn.onclick = function() {
            helpModal.style.display = 'none';
        }
        
        // Cerrar modal haciendo clic fuera
        window.onclick = function(event) {
            if (event.target == helpModal) {
                helpModal.style.display = 'none';
            }
        }
        
        // Inicializar tooltips
        document.querySelectorAll('[data-tooltip]').forEach(function(element) {
            element.addEventListener('mouseenter', function() {
                var tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = this.getAttribute('data-tooltip');
                
                // Posicionar tooltip
                document.body.appendChild(tooltip);
                var rect = this.getBoundingClientRect();
                tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
                tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
                
                // Almacenar referencia al tooltip
                this.tooltip = tooltip;
            });
            
            element.addEventListener('mouseleave', function() {
                if (this.tooltip) {
                    document.body.removeChild(this.tooltip);
                    this.tooltip = null;
                }
            });
        });
    });
    </script>
</body>
</html>